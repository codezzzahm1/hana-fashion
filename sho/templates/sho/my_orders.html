{% extends "sho/base.html" %}

{% block content %}
<style>
  /* Loyalty Points info box */
  .loyalty-points-box {
    background: #e7f1ff;
    border: 1.5px solid #3390ff;
    box-shadow: 0 0 12px #3390ff33;
    border-radius: 12px;
    padding: 12px 24px;
    min-width: 240px;
    user-select: none;
  }
  .order-card {
    border-radius: 1rem;
    box-shadow: 0 6px 18px rgb(0 0 0 / 0.06);
    transition: box-shadow 0.3s ease;
  }
  .order-card:hover {
    box-shadow: 0 10px 28px rgb(0 0 0 / 0.12);
  }
  .order-link:hover {
    text-decoration: none;
    background-color: #f8faff;
    border-radius: 0.5rem;
  }
  /* Badge pills */
  .status-badge {
    padding: 0.45em 0.9em;
    font-size: 0.85rem;
    font-weight: 600;
    border-radius: 50px;
    box-shadow: 0 0 6px rgb(0 0 0 / 0.08);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  /* Item image */
  .item-img {
    width: 56px;
    height: 56px;
    object-fit: cover;
    border-radius: 8px;
    border: 1px solid #ddd;
    transition: transform 0.3s ease;
  }
  .order-link:hover .item-img {
    transform: scale(1.05);
    border-color: #3390ff;
  }
</style>

<div class="container py-5">
  <h2 class="mb-5 fw-semibold">My Orders</h2>

  <div class="d-flex justify-content-end mb-4">
    <div class="loyalty-points-box d-inline-flex align-items-center shadow-sm">
      <i class="bi bi-gift-fill text-primary fs-4 me-3"></i>
      <div>
        <small class="text-uppercase text-muted fw-bold" style="letter-spacing: 0.08em;">Current Loyalty Points</small>
        <div class="fs-4 fw-bold text-primary" style="letter-spacing: 0.04em;">
          {{ user.profile.loyaltypoints|floatformat:2 }}
        </div>
      </div>
    </div>
  </div>

  {% if orders %}
    {% for order in orders %}
      <div class="card order-card mb-5 p-4">
        <div class="d-flex justify-content-between align-items-start flex-wrap gap-3 mb-3">
          <div>
            <h6 class="mb-1">Order ID: <span class="text-secondary fw-normal">{{ order.id }}</span></h6>
            <small class="text-muted">Placed on {{ order.created_at|date:"d M Y, H:i" }}</small>
          </div>
          <div>
            {% if order.status == 'Confirmed' %}
              <span class="status-badge bg-success text-white">Confirmed</span>
            {% elif order.status == 'Pending' %}
              <span class="status-badge bg-warning text-dark">Pending</span>
            {% elif order.status == 'Cancelled' %}
              <span class="status-badge bg-danger text-white">Cancelled</span>
            {% else %}
              <span class="status-badge bg-secondary text-white">{{ order.status }}</span>
            {% endif %}
          </div>
        </div>
        
        <div class="mb-4">
          <h5 class="fw-semibold mb-2">Shipping Address</h5>
          <p class="text-muted fst-italic">{{ order.shipping_address|linebreaksbr }}</p>
          <p class="text-muted fst-italic">{{ order.pincode }}</p>
        </div>

        <ul class="list-group mb-4">
          {% for item in order.items.all %}
          <a href="{% url 'product_detail' item.product.id %}" class="list-group-item d-flex justify-content-between align-items-center order-link px-3 py-2">
            <div class="d-flex align-items-center">
              <img src="{{ item.color.images.first.image.url }}" alt="{{ item.product.name }} Color {{ item.color.color }}" class="item-img me-3">
              <div>
                <div class="fw-semibold">{{ item.product.name }}</div>
                <small class="text-muted d-block">Color: {{ item.color.color }} | Qty: {{ item.quantity }}</small>
              </div>
            </div>
            <div class="fw-semibold fs-5">₹{{ item.price|floatformat:2 }}</div>
          </a>
          {% endfor %}
        </ul>

        <div class="d-flex justify-content-end">
          <h5 class="fw-bold text-primary">Total: ₹{{ order.total|floatformat:2 }}</h5>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="alert alert-info rounded-3 fs-5 px-4 py-3" role="alert">
      You have no orders yet.
    </div>
  {% endif %}
</div>
{% endblock %}
