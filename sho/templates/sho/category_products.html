{% extends 'sho/base.html' %}
{% load static %}

{% block content %}
<style>
/* Ensures all product cards are uniform size regardless of content length */
.product-card {
  height: 360px;           /* Adjust this as desired */
  min-height: 360px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  border-radius: 1.2rem;
}
.product-card-imgbox {
  flex: 1 1 auto;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 0;
  /* Keep padding proportional for large images */
  padding-top: 12px;
  padding-bottom: 6px;
}
.product-card-img {
  max-height: 190px;       /* occupy max possible space for image */
  max-width: 98%;
  width: auto;
  height: auto;
  object-fit: contain;
  margin: 0 auto;
  display: block;
}

.discount-badge {
  width: 40px;
  display: inline-block;
  text-align: center;
  padding: 0.2em 0;
  white-space: nowrap;
}


@media (max-width: 575.98px) {
  .product-card { height: 270px; min-height: 270px; }
  .product-card-img { max-height: 120px; }
}
</style>

<div class="container mt-4">
  <h4 class="mb-4">Products in "{{ category.name }}"</h4>
  <div class="row row-cols-2 row-cols-md-4 g-4">
    {% for product in products %}
      <div class="col">
        <a href="{% url 'product_detail' product.id %}" class="text-decoration-none text-dark">
          <div class="card product-card shadow-sm h-100">
            <div class="product-card-imgbox">
              {% if product.colors.first.images.first %}
                <img src="{{ product.colors.first.images.first.image.url }}"
                     alt="{{ product.name }}"
                     class="product-card-img"
                >
              {% else %}
                <img src="{% static 'img/placeholder.jpg' %}"
                     alt="No image"
                     class="product-card-img"
                >
              {% endif %}
            </div>
            <div class="card-body d-flex flex-column justify-content-end p-2">
              <h6 class="card-title mb-2 text-truncate">{{ product.name }}</h6>
              <div>
                {% if product.discount > 0 %}
                  <span class="text-muted" style="text-decoration: line-through; font-size: 1rem;">
                    ₹{{ product.original_price|floatformat:2 }}
                  </span>
                  <span style="color: #d63384; font-weight: bold; font-size: 1.08rem; margin-left:8px;">
                    ₹{{ product.price }}
                  </span>
                  <span class="badge bg-success discount-badge align-middle ms-1" style="font-size: .95rem;">
                    -{{ product.discount }}%
                  </span>
                {% else %}
                  <span style="color: #b71c6a; font-weight: bold; font-size: 1rem;">₹{{ product.price }}</span>
                {% endif %}
              </div>
            </div>
          </div>
        </a>
      </div>
    {% empty %}
      <div class="col">
        <div class="alert alert-warning w-100">No products found in this category.</div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
